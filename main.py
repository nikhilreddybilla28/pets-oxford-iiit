# -*- coding: utf-8 -*-
"""main.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1vA08moCFHhIT7wbnfpd05lrbJwuqKQSP
"""

#!pip install streamlit
from fastai.vision import *
import streamlit as st
import urllib.request
import torchvision.transforms as T

mg_bytes = st.file_uploader("Squash It!!", type=['png', 'jpg', 'jpeg'])
if img_bytes is not None:
    st.write("Image Uploaded Successfully:")
    img = PIL.Image.open(img_bytes)

    pred_class, pred_idx, outputs = inferencer.predict(img)
    for out in outputs:
        st.write(out)

    st.write("Decision: ", pred_class)

defaults.device = torch.device('cpu')

MODEL_URL = "https://github.com/nikhilreddybilla28/pets-oxford-iiit/raw/master/export.pkl"
urllib.request.urlretrieve(MODEL_URL, "model.pkl")
path = Path(".")

learner = load_learner(path, "model.pkl")

def classifybreed(img):
  pred_class, pred_idx, outputs = inferencer.predict(img)
  st.write(pred_class)
  return pred_class 

def main():
    st.title("Pet Breed Classifier")
    html_temp = """
    <div style="background-color:tomato;padding:12px">
    <h2 style="color:white;text-align:center;"> Bredd classifier App </h2>
    </div>
    """
    st.markdown(html_temp,unsafe_allow_html=True)
    mg_bytes = st.file_uploader("Squash It!!", type=['png', 'jpg', 'jpeg'])
    if img_bytes is not None:
        st.write("Image Uploaded Successfully:")
        img_pil = PIL.Image.open(img_bytes)
        img_tensor = T.ToTensor()(img_pil)
        img = Image(img_tensor)
         
        
        st.write("Classifying...")
        if st.button("Predict"):
            result = classifybreed(img)
      st.success('The output is {}'.format(result))

if __name__=='__main__':
    main()
